{% extends "_master.html" %}
{% load static %}

{% block title %}Profile{% endblock %}

{% block content %}
<div class="vh-100 d-flex flex-column align-items-center py-5" style="background: #f0f2f5;">
  <div class="container">

 <!-- Tour History -->
<div class="card-glass p-4 shadow mb-5" style="max-height: 500px; overflow-y: auto; width: 100%;">
  <h5 class="fw-semibold mb-3">Your Tours History</h5>

  <div class="table-responsive">
    <table class="table table-hover align-middle mb-0">
      <thead class="table-light sticky-top">
        <tr>
          <th>Tour</th>
          <th>City</th>
          <th>Date</th>
          <th>Is Paid</th>
          <th>Booked At</th>
        </tr>
      </thead>

      <tbody>
        {% for booking in bookings %}
        <tr>
          <td>{{ booking.tour.title }}</td>
          <td>{{ booking.tour.city }}</td>
          <td>
            {{ booking.tour_date.start_date }} - {{ booking.tour_date.end_date }}
          </td>
            <td>
              {% if booking.is_paid %}
                <span class="badge bg-success">
                  ✔ OK
                </span>
              {% else %}
                <span class="badge bg-danger">
                  ✖ Not Paid
                </span>
              {% endif %}
            </td>

          <td>{{ booking.created_at|date:"Y-m-d" }}</td>
        </tr>

        {% empty %}
        <tr>
          <td colspan="4" class="text-center text-muted">
            No tours booked yet.
          </td>
        </tr>
        {% endfor %}
      </tbody>

    </table>
  </div>
</div>

    <!-- Profile Edit Form: Two fields per row -->
    <div class="card-glass p-4 shadow mb-5" style="max-height: 500px; overflow-y: auto; width: 100%;">
      <h5 class="fw-semibold mb-3">Edit Your Profile</h5>
      <form method="post" enctype="multipart/form-data">
        {% csrf_token %}
        {{ form.non_field_errors }}

        <!-- Two fields per row -->
        <div class="row g-3">
          {% for field in form %}
            <div class="col-md-6">
              <div class="mb-3">
                <label class="form-label">
                  {% if field.name == 'first_name' %}
                    First Name
                  {% elif field.name == 'last_name' %}
                    Last Name
                  {% elif field.name == 'phone_number' %}
                    Phone Number
                  {% elif field.name == 'email' %}
                    Email
                  {% elif field.name == 'telegram_id' %}
                    Telegram ID
                  {% else %}
                    {{ field.label }}
                  {% endif %}
                </label>
                {{ field }}
                {% if field.errors %}
                  <div class="text-danger mt-1">{{ field.errors|striptags }}</div>
                {% endif %}
              </div>
            </div>
          {% endfor %}
        </div>

        <div class="d-grid mt-3">
          <button type="submit" class="btn btn-primary">Update Profile</button>
        </div>
      </form>
    </div>

  </div>
</div>
{% endblock %}
