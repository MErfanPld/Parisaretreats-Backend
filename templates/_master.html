{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <title>{% block title %}parisaretreats — Travel & Tours{% endblock title %}</title>

  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css" rel="stylesheet">
  <link href="{% static 'css/styles.css' %}" rel="stylesheet">
</head>
<body>
<div id="google_translate_element" style="display:none;"></div>

{% include "./includes/headers.html" %}

{% block content %}{% endblock content %}


<!-- 3. اسکریپت‌ها -->
<script type="text/javascript">
    // الف) تابع اولیه‌سازی گوگل
    function googleTranslateElementInit() {
        new google.translate.TranslateElement({
            pageLanguage: 'en', // زبان اصلی سایت (معمولاً انگلیسی)
            includedLanguages: 'fa,en,tr',
            autoDisplay: false // جلوگیری از پاپ‌آپ پیشنهاد ترجمه
        }, 'google_translate_element');
    }
</script>
<script src="//translate.google.com/translate_a/element.js?cb=googleTranslateElementInit"></script>

<script type="text/javascript">
    // ب) تابع کمکی برای تغییر زبان (با مدیریت تاخیر لود iframe)
    function triggerGoogleTranslate(lang) {
        // 1. تغییر زبان در ویجت اصلی
        var googleCombo = document.querySelector('#google_translate_element .goog-te-combo');
        if (googleCombo) {
            googleCombo.value = lang;
            googleCombo.dispatchEvent(new Event('change'));
        }
        
        // 2. تلاش برای تغییر در iframe (برای اطمینان بیشتر)
        var iframe = document.querySelector('#google_translate_element iframe');
        if (iframe && iframe.contentWindow) {
            try {
                var innerDoc = iframe.contentDocument || iframe.contentWindow.document;
                var innerSelect = innerDoc.querySelector('.goog-te-combo');
                if (innerSelect && innerSelect.value !== lang) {
                    innerSelect.value = lang;
                    innerSelect.dispatchEvent(new Event('change'));
                }
            } catch (e) {
                // خطای CORS در برخی مرورگرها طبیعی است، نادیده می‌گیریم
            }
        }
    }

    // ج) اتصال ایونت به منوی شما
    document.getElementById('langSelect').addEventListener('change', function() {
        triggerGoogleTranslate(this.value);
    });

    // د) (اختیاری) هماهنگ کردن منو با زبان فعلی صفحه در جنگو
    // اگر کاربر رفرش کند، منو باید روی زبان فعلی باشد
    window.addEventListener('load', function() {
        var currentLang = "{{ LANGUAGE_CODE }}"; // متغیر جنگو
        var select = document.getElementById('langSelect');
        if (select && currentLang) {
            select.value = currentLang;
        }
    });
</script>

<!-- 4. استایل برای مخفی کردن نوار بنفش رنگ بالای گوگل -->
<style>
    .goog-te-banner-frame { display: none !important; }
    body { top: 0 !important; } /* جلوگیری از پرش صفحه */
    /* مخفی کردن لینک‌های اضافی گوگل */
    .goog-logo-link { display: none !important; }
    .goog-te-gadget { font-size: 0 !important; }
</style>

{% include "./includes/footer.html" %}

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
<script src="{% static 'js/app.js' %}"></script>
</body>
</html>
