{% extends "_master.html" %}
{% load static %}

{% block title %}{{ tour.title }} | parisaretreats{% endblock %}

{% block content %}
<section class="py-4">
  <div class="container container-narrow">

    <div class="row g-4">

      <!-- Gallery -->
      <div class="col-lg-7">
        <div id="detailCarouselPage" class="carousel slide carousel-dark" data-bs-ride="carousel">
          <div class="carousel-inner">

            {% for img in images %}
            <div class="carousel-item {% if forloop.first %}active{% endif %}">
              <img class="w-100 rounded" src="{{ img.image.url }}" alt="">
            </div>
            {% endfor %}

          </div>

          <button class="carousel-control-prev" type="button"
                  data-bs-target="#detailCarouselPage" data-bs-slide="prev">
            <span class="carousel-control-prev-icon"></span>
          </button>

          <button class="carousel-control-next" type="button"
                  data-bs-target="#detailCarouselPage" data-bs-slide="next">
            <span class="carousel-control-next-icon"></span>
          </button>
        </div>
      </div>

      <!-- Info -->
      <div class="col-lg-5">

        <h3 class="fw-semibold">{{ tour.title }}</h3>
        <p class="text-muted" style="word-break: break-word; text-align: justify;">
        {{ tour.description|linebreaks }}
        </p>

        <h5 class="text-primary mb-3">${{ tour.price }}</h5>

        <!-- Features (static for now) -->
        <div class="grid grid-2">

        {% for feature in tour.features.all %}
        <div class="card-glass p-3">
        <i class="bi bi-check-circle"></i>
        {{ feature.name }}
        </div>
        {% endfor %}

        </div>

        <!-- Booking Form -->
        <form method="post" class="mt-4">
          {% csrf_token %}

          <!-- Dates -->
          <label class="form-label mt-3">Available Dates</label>
          <select name="tour_date" class="form-select" required>
            {% for d in dates %}
            <option value="{{ d.id }}">
              {{ d.start_date }} - {{ d.end_date }}
            </option>
            {% endfor %}
          </select>

          <!-- Times -->
          <label class="form-label mt-3">Times</label>
          <select name="tour_time" class="form-select" required>
            {% for d in dates %}
              {% for t in d.times.all %}
              <option value="{{ t.id }}">{{ t.time }}</option>
              {% endfor %}
            {% endfor %}
          </select>

          <!-- Personal Info Fields -->
          {% for field in form %}
          <div class="mt-3">
            <label class="form-label">
                  {% if field.name == 'full_name' %}
                    Full Name
                  {% elif field.name == 'phone_number' %}
                    Phone Number
                  {% elif field.name == 'email' %}
                    Email
                  {% elif field.name == 'number_of_people' %}
                    Number of people
                  {% else %}
                    {{ field.label }}
                  {% endif %}
            </label>
            {{ field }}
            {% if field.errors %}
              <div class="text-danger">{{ field.errors }}</div>
            {% endif %}
            
          </div>
          {% endfor %}



          <div class="d-grid mt-4">
            <button class="btn btn-primary">Book Now</button>
          </div>

        </form>

      </div>

    </div>

  </div>
</section>
{% endblock %}
